cmake_minimum_required (VERSION 3.1)

################################
# OpenMapper
################################

PROJECT(OpenMapper)
SET(OM_WRAPPER_LIB "OpenMapper")
SET(OM_WRAPPER_APP "OpenMapperApp")

SET(CMAKE_CXX_STANDARD 11)
SET(CMAKE_CXX_STANDARD_REQUIRED ON)

SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS}  -w")
SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -w")

SET(BUILD_TESTS TRUE CACHE BOOL "Build engine tests")


################################
# File Globbing
################################

FILE(GLOB_RECURSE OM_LIB_HEADERS "${CMAKE_CURRENT_LIST_DIR}/include/wrapper.h")
FILE(GLOB_RECURSE OM_LIB_SOURCES "${CMAKE_CURRENT_LIST_DIR}/src/wrapper.cc")

SET(OM_LIB_RESOURCES ${OM_LIB_SOURCES} ${OM_LIB_HEADERS})

SET(OM_APP_RESOURCES "${CMAKE_CURRENT_LIST_DIR}/src/app/main.cc")

LIST(APPEND CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}/cmake_modules)

################################
# Target Definitions
################################

ADD_LIBRARY(${OM_WRAPPER_LIB} STATIC ${OM_LIB_RESOURCES})

ADD_EXECUTABLE(${OM_WRAPPER_APP} ${OM_APP_RESOURCES})

TARGET_INCLUDE_DIRECTORIES(${OM_WRAPPER_LIB} PUBLIC "${CMAKE_CURRENT_LIST_DIR}/include")
TARGET_INCLUDE_DIRECTORIES(${OM_WRAPPER_APP} PUBLIC "${CMAKE_CURRENT_LIST_DIR}/include")

SET_TARGET_PROPERTIES(${OM_WRAPPER_APP} PROPERTIES
    DEBUG_POSTFIX "_d"
    RUNTIME_OUTPUT_DIRECTORY ../bin/
    RUNTIME_OUTPUT_DIRECTORY_DEBUG ../bin/
    RUNTIME_OUTPUT_DIRECTORY_RELEASE ../bin/
    RUNTIME_OUTPUT_DIRECTORY_RELWITHDEBINFO ../bin/)

SET_TARGET_PROPERTIES(${OM_WRAPPER_LIB} PROPERTIES
  DEBUG_POSTFIX "_d"
  LIBRARY_OUTPUT_DIRECTORY ../lib/
  LIBRARY_OUTPUT_DIRECTORY_DEBUG ../lib/
  LIBRARY_OUTPUT_DIRECTORY_RELEASE ../lib/
  LIBRARY_OUTPUT_DIRECTORY_RELWITHDEBINFO ../lib/
  ARCHIVE_OUTPUT_DIRECTORY ../lib/
  ARCHIVE_OUTPUT_DIRECTORY_DEBUG ../lib/
  ARCHIVE_OUTPUT_DIRECTORY_RELWITHDEBINFO ../lib/
  ARCHIVE_OUTPUT_DIRECTORY_RELEASE ../lib/)

################################
# Dependencies
################################

FIND_PACKAGE(THREADS REQUIRED)
FIND_PACKAGE(OpenCV 3.0.0 REQUIRED)
FIND_PACKAGE(Eigen3 3.1.0 REQUIRED)
FIND_PACKAGE(OpenGL REQUIRED)
# FIND_LIBRARY(OpenGL_LIBRARIES OpenGL)
# SET(OpenCV_DEBUG_LIBRARIES ${OpenCV_LIBRARIES})
INCLUDE_DIRECTORIES("/usr/local/include")

INCLUDE("${CMAKE_CURRENT_LIST_DIR}/thirdparty/slam_engine/ORB_SLAM2/CMakeLists.txt")

INCLUDE_DIRECTORIES(
  ${CMAKE_CURRENT_LIST_DIR}/thirdparty/slam_engine/ORB_SLAM2/include
  ${CMAKE_CURRENT_LIST_DIR}/thirdparty/slam_engine/ORB_SLAM2/
  ${CMAKE_CURRENT_LIST_DIR}/thirdparty/slam_engine/ORB_SLAM2/Thirdparty/DBoW2/DBoW2
  ${CMAKE_CURRENT_LIST_DIR}/thirdparty/slam_engine/ORB_SLAM2/Thirdparty/g2o/g2o/core
  ${CMAKE_CURRENT_LIST_DIR}/thirdparty/slam_engine/ORB_SLAM2/Thirdparty/g2o/g2o/solvers
  ${CMAKE_CURRENT_LIST_DIR}/thirdparty/slam_engine/ORB_SLAM2/Thirdparty/g2o/g2o/stuff
  ${CMAKE_CURRENT_LIST_DIR}/thirdparty/slam_engine/ORB_SLAM2/Thirdparty/g2o/g2o/types  
  ${EIGEN3_INCLUDE_DIR}
)

TARGET_LINK_LIBRARIES(${OM_WRAPPER_LIB}
# debug ${OpenGL_LIBRARIES} optimized ${OpenGL_LIBRARIES}
  debug ${OpenCV_LIBRARIES} optimized ${OpenCV_LIBRARIES}
  debug ${ORB_SLAM2_LIB} optimized ${ORB_SLAM2_LIB}
  debug ${DBOW2_LIB} optimized ${DBOW2_LIB}
  debug ${G2O_LIB} debug ${G2O_LIB}
  pthread
)

TARGET_LINK_LIBRARIES(${OM_WRAPPER_APP}
  # debug ${OpenGL_LIBRARIES} optimized ${OpenGL_LIBRARIES}
  debug ${OpenCV_LIBRARIES} optimized ${OpenCV_LIBRARIES}
  debug ${OM_WRAPPER_LIB} optimized ${OM_WRAPPER_LIB}
  debug ${ORB_SLAM2_LIB} optimized ${ORB_SLAM2_LIB}
  debug ${DBOW2_LIB} optimized ${DBOW2_LIB}
  debug ${G2O_LIB} debug ${G2O_LIB}
  pthread
)

IF(BUILD_TESTS)
  # INCLUDE("${CMAKE_CURRENT_LIST_DIR}/test/CMakeLists.txt")
ENDIF(BUILD_TESTS)

# # Uncomment to display all CMAKE variables:
# GET_CMAKE_PROPERTY(VARIABLE_NAMES VARIABLES)
# FOREACH (VARIABLE_NAME ${VARIABLE_NAMES})
#    MESSAGE(STATUS "${VARIABLE_NAME}=${${VARIABLE_NAME}}")
# ENDFOREACH()
