cmake_minimum_required (VERSION 3.1)

################################
# OpenMapper
################################

PROJECT(OpenMapper)
SET(OM_WRAPPER_LIB "OpenMapper")
SET(OM_WRAPPER_APP "OpenMapperApp")

SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11")

SET(BUILD_TESTS TRUE CACHE BOOL "Build engine tests")


################################
# File Globbing
################################

FILE(GLOB_RECURSE OM_LIB_HEADERS "${CMAKE_CURRENT_LIST_DIR}/include/wrapper.h")
# FILE(GLOB_RECURSE OM_LIB_HEADERS "${CMAKE_CURRENT_LIST_DIR}/include/*.h")
FILE(GLOB_RECURSE OM_LIB_SOURCES "${CMAKE_CURRENT_LIST_DIR}/src/wrapper.cc")
# FILE(GLOB_RECURSE OM_LIB_SOURCES "${CMAKE_CURRENT_LIST_DIR}/src/*.cc")

SET(OM_LIB_RESOURCES ${OM_LIB_SOURCES} ${OM_LIB_HEADERS})

SET(OM_APP_RESOURCES "${CMAKE_CURRENT_LIST_DIR}/src/app/main.cc")

################################
# Target Definitions
################################

ADD_LIBRARY(${OM_WRAPPER_LIB} STATIC ${OM_LIB_RESOURCES})

ADD_EXECUTABLE(${OM_WRAPPER_APP} ${OM_APP_RESOURCES})

TARGET_INCLUDE_DIRECTORIES(${OM_WRAPPER_LIB} PUBLIC "${CMAKE_CURRENT_LIST_DIR}/include")
TARGET_INCLUDE_DIRECTORIES(${OM_WRAPPER_APP} PUBLIC "${CMAKE_CURRENT_LIST_DIR}/include")

SET_TARGET_PROPERTIES(${OM_WRAPPER_APP} PROPERTIES
    DEBUG_POSTFIX "_d"
    RUNTIME_OUTPUT_DIRECTORY ../bin/
    RUNTIME_OUTPUT_DIRECTORY_DEBUG ../bin/
    RUNTIME_OUTPUT_DIRECTORY_RELEASE ../bin/
    RUNTIME_OUTPUT_DIRECTORY_RELWITHDEBINFO ../bin/)

SET_TARGET_PROPERTIES(${OM_WRAPPER_LIB} PROPERTIES
  DEBUG_POSTFIX "_d"
  LIBRARY_OUTPUT_DIRECTORY ../lib/
  LIBRARY_OUTPUT_DIRECTORY_DEBUG ../lib/
  LIBRARY_OUTPUT_DIRECTORY_RELEASE ../lib/
  LIBRARY_OUTPUT_DIRECTORY_RELWITHDEBINFO ../lib/
  ARCHIVE_OUTPUT_DIRECTORY ../lib/
  ARCHIVE_OUTPUT_DIRECTORY_DEBUG ../lib/
  ARCHIVE_OUTPUT_DIRECTORY_RELWITHDEBINFO ../lib/
  ARCHIVE_OUTPUT_DIRECTORY_RELEASE ../lib/)


################################
# Dependencies
################################

# # OpenCV
# FIND_PACKAGE(OpenCV 3.2.0 REQUIRED)
# SET(OpenCV_DEBUG_LIBRARIES ${OpenCV_LIBRARIES})
# # OpenGL
# FIND_PACKAGE(OpenGL REQUIRED)
# FIND_LIBRARY(OpenGL_LIBRARIES OpenGL)

# TARGET_LINK_LIBRARIES(${OM_WRAPPER_LIB}
#   debug ${OpenGL_LIBRARIES} optimized ${OpenGL_LIBRARIES}
#   debug ${OpenCV_DEBUG_LIBRARIES} optimized ${OpenCV_LIBRARIES})

TARGET_LINK_LIBRARIES(${OM_WRAPPER_APP}
  # debug ${OpenGL_LIBRARIES} optimized ${OpenGL_LIBRARIES}
  # debug ${OpenCV_DEBUG_LIBRARIES} optimized ${OpenCV_LIBRARIES}
debug ${OM_WRAPPER_LIB} optimized ${OM_WRAPPER_LIB})

# Build ORB_SLAM2 and its dependencies. 
INCLUDE("${CMAKE_CURRENT_LIST_DIR}/thirdparty/slam_engine/ORB_SLAM2/Thirdparty/DBoW2/CMakeLists.txt")
INCLUDE("${CMAKE_CURRENT_LIST_DIR}/thirdparty/slam_engine/ORB_SLAM2/Thirdparty/g2o/CMakeLists.txt")
INCLUDE("${CMAKE_CURRENT_LIST_DIR}/thirdparty/slam_engine/ORB_SLAM2/CMakeLists.txt")

# Uncompress the vocabulary.
execute_process (
     COMMAND tar "${CMAKE_CURRENT_LIST_DIR}/thirdparty/slam_engine/ORB_SLAM2/Vocabulary/ORBvoc.txt.tar.gz"
)

IF(BUILD_TESTS)
  INCLUDE("${CMAKE_CURRENT_LIST_DIR}/test/CMakeLists.txt")
ENDIF(BUILD_TESTS)

# # Uncomment to display all CMAKE variables:
# GET_CMAKE_PROPERTY(VARIABLE_NAMES VARIABLES)
# FOREACH (VARIABLE_NAME ${VARIABLE_NAMES})
#    MESSAGE(STATUS "${VARIABLE_NAME}=${${VARIABLE_NAME}}")
# ENDFOREACH()
